<UserControl x:Class="MacroScanAI.Controls.TreeAndEditor.TreeAndEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
             xmlns:avalonSearch="clr-namespace:ICSharpCode.AvalonEdit.Search;assembly=ICSharpCode.AvalonEdit"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MacroScanAI.Controls.TreeAndEditor"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             PreviewKeyDown="UserControl_PreviewKeyDown">



    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32" /> <!-- Open file bar -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border BorderThickness="0" Grid.Row="0">
            <Grid Background="Black">

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>


                <Button Click="OpenFile_Click"
                        Grid.Column="0"
                        x:Name="openDoc_Btn"
                        ToolTip="Open Document"
                        BorderBrush="Transparent" 
                        BorderThickness="0" 
                        Background="Transparent">
                    <Image x:Name="openFolderImg" Width="32" Height="32" Source="pack://application:,,,/Controls/TreeAndEditor/Assets/openfolder.png" />
                </Button>


                <TextBox x:Name="docFileNameTxtBox"
                        Grid.Column="1"
                         Height="25"
                         MaxWidth="500"
                         TextAlignment="Left"
                         Background="Black"
                         Foreground="#C2C3C5"
                         Padding="0"
                         FontSize="15"
                         BorderThickness="0"
                         IsReadOnly="True"
                         HorizontalScrollBarVisibility="Hidden"
                         VerticalScrollBarVisibility="Disabled"
                         TextWrapping="NoWrap"
                         Cursor="IBeam"
                         IsReadOnlyCaretVisible="True" />

                <!-- Scan with AI Button -->
                <Button Grid.Column="2"
                        Click="ScanWithAI_Click"
                        x:Name="scanWithAI_Btn"
                        Margin="7,7,0,7"
                        Background="Green"
                        Foreground="White"
                        Visibility="Hidden"
                        ToolTip="Scan with AI"
                        BorderBrush="Transparent"
                        FontWeight="Bold"
                        BorderThickness="0" >
                    SCAN WITH AI
                    <!--
                        <Image x:Name="scanImg" Width="64" Height="32" Source="pack://application:,,,/Controls/TreeAndEditor/Assets/scan.png" />
                        -->
                </Button>

                <Grid Grid.Column="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition Width="auto" />
                    </Grid.ColumnDefinitions>

                    <Button Click="Settings_Click"
                            Grid.Column="0"
                            x:Name="settings_Btn"
                            ToolTip="Settings"
                            BorderBrush="Transparent" 
                            BorderThickness="0" 
                            Background="Transparent"
                            Visibility="Collapsed">
                        <Image x:Name="settingsImg" Width="32" Height="32" Source="pack://application:,,,/Controls/TreeAndEditor/Assets/settings.png" />
                    </Button>

                    <Button Click="About_Click"
                            Grid.Column="1"
                            x:Name="about_Btn"
                            ToolTip="About"
                            BorderBrush="Transparent" 
                            BorderThickness="0" 
                            Background="Transparent">
                        <Image x:Name="aboutImg" Width="32" Height="32" Source="pack://application:,,,/Controls/TreeAndEditor/Assets/about.png" />
                    </Button>
                </Grid>
            </Grid>
        </Border>


        <!-- Main content: Grid with two columns -->
        <Grid Grid.Row="1"  x:Name="TreeAndEditorGrid" Background="#1E1E1E">
            <Grid.ColumnDefinitions>
                <!-- TreeView column -->
                <ColumnDefinition Width="400"/>
                <!-- Divider / splitter column -->
                <ColumnDefinition Width="5"/>
                <!-- Hex viewer column -->
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">

                <Grid.RowDefinitions>
                    <RowDefinition Height="32"/>
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" x:Name="showOptionsGrid" Visibility="Hidden" Background="#1E1E1E">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Grid.Resources>
                        <!-- Light theme radio style for dark background -->
                        <Style TargetType="RadioButton">
                            <Setter Property="Foreground" Value="#DCDCDC"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="RadioButton">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <Grid Width="14" Height="14" Margin="0,0,6,0">
                                                <Ellipse Stroke="#DCDCDC"
                                             StrokeThickness="1.5"
                                             Fill="Transparent"/>
                                                <Ellipse x:Name="InnerDot"
                                             Width="8"
                                             Height="8"
                                             Fill="#DCDCDC"
                                             Visibility="Collapsed"/>
                                            </Grid>
                                            <ContentPresenter VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsChecked" Value="True">
                                                <Setter TargetName="InnerDot" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter TargetName="InnerDot" Property="Fill" Value="White"/>
                                                <Setter TargetName="InnerDot" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Grid.Resources>

                    <TextBlock Text="Show:"
                           Grid.Column="0"
                           Foreground="#DCDCDC"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>

                    <RadioButton
                            x:Name="ModulesOnlyRadioBtn"
                            Content="Modules Only"
                             Grid.Column="1"
                             IsChecked="True"
                             GroupName="ViewMode"
                             Checked="ShowModulesOnly_Checked"
                             VerticalAlignment="Center"
                             Margin="0,0,12,0"/>

                    <RadioButton Content="All"
                            Grid.Column="2"
                            GroupName="ViewMode"
                            Checked="ShowAll_Checked"
                            VerticalAlignment="Center"/>
                </Grid>

                <!-- Left: TreeView -->
                <TreeView Name="OleTreeView"
                          Grid.Row="1"
                          Background="#1E1E1E"
                          BorderThickness="1,1,0,1"
                          SelectedItemChanged="OleTreeView_SelectedItemChanged"
                          PreviewMouseRightButtonDown="OleTreeView_PreviewMouseRightButtonDown">

                    <TreeView.ItemContainerStyle>
                        <Style TargetType="TreeViewItem">
                            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
                        </Style>
                    </TreeView.ItemContainerStyle>

                    <TreeView.Resources>
                        <HierarchicalDataTemplate DataType="{x:Type local:OleNode}" ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal">
                                <StackPanel.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Save Stream Bytes As..."
                                          Click="SaveStream_Click"
                                          IsEnabled="{Binding IsStream}" />
                                    </ContextMenu>
                                </StackPanel.ContextMenu>

                                <Image Source="{Binding Icon}" Width="32" Height="32" Margin="0,0,4,0"/>
                                <TextBlock
                                    Text="{Binding DisplayName}"
                                    Margin="0,8,0,0"
                                    Foreground="#DCDCDC"
                                    />
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.Resources>

                </TreeView>
            </Grid>

            <!-- GridSplitter as divider -->
            <GridSplitter Grid.Column="1"
                          Width="5"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          Background="Gray"
                          ShowsPreview="True"/>

            <!-- Right panel -->
            <Grid Grid.Column="2" Background="#1E1E1E">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Search bar -->
                    <RowDefinition Height="*"/>
                    <!-- Editor -->
                    <RowDefinition Height="Auto"/>
                    <!-- Hidden properties grid -->
                </Grid.RowDefinitions>

                <!-- SEARCH BAR -->
                <Border Grid.Row="0"
                    BorderBrush="Gray"
                    BorderThickness="0,0,0,1"
                    Background="#1E1E1E"
                    Height="33">

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                    </Grid>
                </Border>

                <Grid Grid.Row="1">

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- Search bar -->
                        <RowDefinition Height="*"/>
                        <!-- Editor -->
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0"
                        BorderBrush="Gray"
                        BorderThickness="0,0,0,1"
                        Background="#1E1E1E">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto"/>
                                <ColumnDefinition Width="auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Save file button -->
                            <Button Grid.Column="0"
                                x:Name="saveFileBtn"
                                Click="SaveFileButton_Click"
                                Background="Transparent"
                                BorderThickness="0"
                                Visibility="Hidden"
                                Padding="0"
                                ToolTip="Save Document"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                Cursor="Hand">
                                <Image Width="32" Height="32" Source="pack://application:,,,/Controls/TreeAndEditor/Assets/savefile.png"/>
                            </Button>

                            <TextBox x:Name="streamNameTxtBox"
                                Grid.Column="1"
                                Height="25"
                                TextAlignment="Left"
                                Background="#1E1E1E"
                                Foreground="White"
                                Padding="0"
                                FontSize="15"
                                BorderThickness="0"
                                IsReadOnly="True"
                                HorizontalScrollBarVisibility="Hidden"
                                VerticalScrollBarVisibility="Disabled"
                                TextWrapping="NoWrap"
                                Cursor="IBeam"
                                IsReadOnlyCaretVisible="True" />

                            <TextBox 
                                x:Name="txBxPressF"
                                Grid.Column="3"
                                Height="25"
                                HorizontalAlignment="Right"
                                Visibility="Hidden"
                                Margin="0,5,20,0"
                                VerticalAlignment="Bottom"
                                Background="#1E1E1E"
                                Foreground="White"
                                BorderThickness="0"
                                Text="Press Ctrl+F to Search"/>
                        </Grid>
                    </Border>

                    <!-- The Editor -->
                    <avalonEdit:TextEditor Grid.Row="1"
                        Name="VbaEditor"
                        FontFamily="Consolas"
                        FontSize="12"
                        FontWeight="Bold"
                        Background="#1E1E1E"
                        Foreground="#DCDCDC"
                        ShowLineNumbers="True"
                        Padding="8,8,0,8"
                        IsReadOnly="True"
                        HorizontalScrollBarVisibility="Auto"
                        VerticalScrollBarVisibility="Auto" />
                </Grid>

                <!-- Property viewer -->
                <DataGrid Grid.Row="2" Name="PropertiesDataGrid" AutoGenerateColumns="False" Visibility="Collapsed">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Property" Binding="{Binding Name}" Width="*"/>
                        <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="2*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>


        </Grid>

    </Grid>
</UserControl>
